<!DOCTYPE html>
<html lang="en">
<head>
  <title>Slimer Timer: For contractions and other interval-oriented events.</title>
  <style>
    body {
      font-family:Arial, Helvetica, sans-serif;
      text-align: center;
      color: #666;
      font-size: 12px;
      text-shadow: 1px 1px 0px #fff;
      background: #eaebec;
    }
    table {
      margin-left: auto;
      margin-right: auto;
      border:#ccc 1px solid;

      -moz-border-radius:3px;
      -webkit-border-radius:3px;
      border-radius:3px;

      -moz-box-shadow: 0 1px 2px #d1d1d1;
      -webkit-box-shadow: 0 1px 2px #d1d1d1;
      box-shadow: 0 1px 2px #d1d1d1;
    }
    table th {
      padding:21px 25px 22px 25px;
      border-top:1px solid #fafafa;
      border-bottom:1px solid #e0e0e0;

      background: #ededed;
      background: -webkit-gradient(linear, left top, left bottom, from(#ededed), to(#ebebeb));
      background: -moz-linear-gradient(top,  #ededed,  #ebebeb);
    }
    table th:first-child {
      text-align: left;
      padding-left:20px;
    }
    table tr:first-child th:first-child {
      -moz-border-radius-topleft:3px;
      -webkit-border-top-left-radius:3px;
      border-top-left-radius:3px;
    }
    table tr:first-child th:last-child {
      -moz-border-radius-topright:3px;
      -webkit-border-top-right-radius:3px;
      border-top-right-radius:3px;
    }
    table tr {
      text-align: center;
      padding-left:20px;
    }
    table td:first-child {
      text-align: left;
      padding-left:20px;
      border-left: 0;
    }
    table td {
      padding:18px;
      border-top: 1px solid #ffffff;
      border-bottom:1px solid #e0e0e0;
      border-left: 1px solid #e0e0e0;

      background: #fafafa;
      background: -webkit-gradient(linear, left top, left bottom, from(#fbfbfb), to(#fafafa));
      background: -moz-linear-gradient(top,  #fbfbfb,  #fafafa);
    }
    table tr.even td {
      background: #f6f6f6;
      background: -webkit-gradient(linear, left top, left bottom, from(#f8f8f8), to(#f6f6f6));
      background: -moz-linear-gradient(top,  #f8f8f8,  #f6f6f6);
    }
    table tr:last-child td {
      border-bottom:0;
    }
    table tr:last-child td:first-child {
      -moz-border-radius-bottomleft:3px;
      -webkit-border-bottom-left-radius:3px;
      border-bottom-left-radius:3px;
    }
    table tr:last-child td:last-child {
      -moz-border-radius-bottomright:3px;
      -webkit-border-bottom-right-radius:3px;
      border-bottom-right-radius:3px;
    }
    table tr:hover td {
      background: #f2f2f2;
      background: -webkit-gradient(linear, left top, left bottom, from(#f2f2f2), to(#f0f0f0));
      background: -moz-linear-gradient(top,  #f2f2f2,  #f0f0f0);  
    }
    button {
      padding: 2em;
      color: white;
    }
    button.start {
      background-color: green;
    }
    button.stop {
      background-color: red;
    }
  </style>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>

  <script>
  var toggleTimerButton = null;
  var timerData = [];
  function getClockTime(aNow) {
    var hours = aNow.getHours();
    var minutes = aNow.getMinutes();
    var seconds = aNow.getSeconds();
    var ampm = hours >= 12 ? 'pm' : 'am';
    minutes = minutes < 10 ? '0' + minutes : minutes;
    seconds = seconds < 10 ? '0' + seconds : seconds;
    hours = hours % 12;
    // The hour '0' should be '12'.
    hours = hours ? hours : 12; 
    return hours + ':' + minutes + ':' + seconds + " " + ampm;
  }
  function getElapsedTime(earlyTime, laterTime) {
    elapsedSeconds = (laterTime - earlyTime) / 1000;
    var elapsedMinutes = Math.floor(elapsedSeconds / 60);
    var remainingSeconds = Math.round(elapsedSeconds % 60);

    return "" + elapsedMinutes + " mins " + remainingSeconds + " seconds";
  }
  $(document).ready(function() {
    toggleTimerButton = $("#toggle-timer")
    toggleTimerButton.click(function() {
      var rightNow = new Date();
      if (toggleTimerButton.hasClass("start")) {
        var startedTime = getClockTime(rightNow);
        // Starting always pushes a new item onto the array.
        console.log(timerData.length);
        timerData[timerData.length] = {'startedTime': rightNow};
        console.log("Started at " + startedTime);
        var rowName = 'row' + timerData.length;
        var oldRowName = 'row' + (timerData.length - 1);
        if (timerData.length > 1) {
          var newRow = '<tr id="' + rowName + '"><td class="time">-</td><td class="length">-</td><td class="interval">-</td></tr>';
          $("#" + oldRowName).before(newRow);
        }
        else {
          var newRow = '<tr id="' + rowName + '"><td class="time">-</td><td class="length">-</td><td class="interval">n/a</td></tr>';
          $("tbody").append(newRow);
        }
        $("#" + rowName + "> .time").text(startedTime);
        toggleTimerButton.text('Stop timer');
      }
      if (toggleTimerButton.hasClass("stop")) {
        var thisTime = timerData.length - 1;
        var lastTime = thisTime - 1;
        timerData[thisTime].stoppedTime = rightNow;
        console.log(timerData);
        var elapsedTime = getElapsedTime(timerData[thisTime].startedTime, timerData[thisTime].stoppedTime);
        var rowName = 'row' + timerData.length;
        $("#" + rowName + "> .length").text(elapsedTime);
        if (timerData.length > 1) {
          var intervalTime = getElapsedTime(timerData[lastTime].startedTime, timerData[thisTime].startedTime);
          $("#" + rowName + "> .interval").text(intervalTime);
        }
        toggleTimerButton.text('Start timer');
      }
      toggleTimerButton.toggleClass('start stop');
      event.preventDefault();
    });
  });
  </script>
</head>
<body>
  <h1>Contraction timer</h1>
        <button id="toggle-timer" class="start" type="submit">Start timer</button>
<table>
  <thead>
    <tr>
      <th>Start time</th><th>Length</th><th>Interval</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>

  <h2>To do:</h2>
  Etc:
  <ol>
    <li>Make <a href="http://stackoverflow.com/questions/17067294/html-table-with-100-width-with-vertical-scroll-inside-tbody">tbody scroll separate from thead</a></li>
    <li>Create a way to put data into the anchor portion of the url (#) link for sharing</li>
    <li>Create a way to put data into an email body</li>
    <li>Use localStorage instead of a js array</li>
    <li>Make the cell backgrounds start a light green and turn darker green approaching "go time"</li>
    <li>Accept several keystrokes to indicate a contraction (s, space)</li>
    <li>Show duration counting up seconds</li>
  </ol>
</body>
</html>


